{"priority": "major", "kind": "bug", "repository": {"links": {"self": {"href": "data/repositories/osrf/subt.json"}, "html": {"href": "#!/osrf/subt"}, "avatar": {"href": "data/bytebucket.org/ravatar/{3c95f6ad-c304-407c-b838-09597d836552}ts=2272898"}}, "type": "repository", "name": "subt", "full_name": "osrf/subt", "uuid": "{3c95f6ad-c304-407c-b838-09597d836552}"}, "links": {"attachments": {"href": "data/repositories/osrf/subt/issues/94/attachments_page=1.json"}, "self": {"href": "data/repositories/osrf/subt/issues/94.json"}, "watch": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/subt/issues/94/watch"}, "comments": {"href": "data/repositories/osrf/subt/issues/94/comments_page=1.json"}, "html": {"href": "#!/osrf/subt/issues/94/x3-x4-misconfigured-odom-no-resposne-to"}, "vote": {"href": "https://api.bitbucket.org/2.0/repositories/osrf/subt/issues/94/vote"}}, "reporter": {"display_name": "Arthur Schang", "uuid": "{1403972a-9b64-442b-a69c-d7e9557e1d87}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7B1403972a-9b64-442b-a69c-d7e9557e1d87%7D"}, "html": {"href": "https://bitbucket.org/%7B1403972a-9b64-442b-a69c-d7e9557e1d87%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/initials/AS-0.png"}}, "nickname": "Arthur Schang", "type": "user", "account_id": "557058:14b7fd50-d65a-47a8-825c-fa89681d07bd"}, "title": "X3/X4 Misconfigured Odom (No Resposne to Velocity Commands on /<vehicle_name>/cmd_vel)", "component": null, "votes": 1, "watches": 7, "content": {"raw": "There is a broken link in the UKF from the new TF tree that prevents filtered odometry from being published and thus the conversion from RPY Thrust to individual motor commands from going through.  It can be fixed as follows for the X4:\r\n\r\n```\r\ndiff -r d09a3c51a635 x4_control/launch/control.launch\r\n--- a/x4_control/launch/control.launch  Fri Jun 28 23:16:31 2019 +0000\r\n+++ b/x4_control/launch/control.launch  Tue Jul 02 17:13:54 2019 -0400\r\n@@ -11,9 +11,10 @@\r\n       <param name=\"frequency\" value=\"1000.\" />\r\n       <param name=\"sensor_timeout\" value=\"0.2\" />\r\n       <param name=\"two_d_mode\" value=\"false\" />\r\n-      <param name=\"odom_frame\" value=\"$(arg world_name)\" />\r\n-      <param name=\"base_link_frame\" value=\"$(arg world_name)/$(arg x4_name)/base_link/imu_sensor\" />\r\n-      <param name=\"world_frame\" value=\"$(arg world_name)\" />\r\n+      <param name=\"odom_frame\" value=\"$(arg x4_name)/odom\" />\r\n+      <param name=\"base_link_frame\" value=\"$(arg x4_name)\" />\r\n+      <param name=\"base_link_frame_output\" value=\"$(arg x4_name)\" />\r\n+      <param name=\"world_frame\" value=\"$(arg x4_name)/odom\" />\r\n       <param name=\"publish_tf\" value=\"false\" />\r\n       <param name=\"imu0\" value=\"imu/data\" />\r\n       <rosparam param=\"imu0_config\">\r\n```\r\n\r\nThis is also the case with the X3:\r\n\r\n```\r\ndiff -r d09a3c51a635 x3_control/launch/control.launch\r\n--- a/x3_control/launch/control.launch  Fri Jun 28 23:16:31 2019 +0000\r\n+++ b/x3_control/launch/control.launch  Tue Jul 02 17:26:36 2019 -0400\r\n@@ -11,9 +11,10 @@\r\n       <param name=\"frequency\" value=\"1000.\" />\r\n       <param name=\"sensor_timeout\" value=\"0.2\" />\r\n       <param name=\"two_d_mode\" value=\"false\" />\r\n-      <param name=\"odom_frame\" value=\"$(arg world_name)\" />\r\n-      <param name=\"base_link_frame\" value=\"$(arg world_name)/$(arg x3_name)/base_link/imu_sensor\" />\r\n-      <param name=\"world_frame\" value=\"$(arg world_name)\" />\r\n+      <param name=\"odom_frame\" value=\"$(arg x3_name)/odom\" />\r\n+      <param name=\"base_link_frame\" value=\"$(arg x3_name)\" />\r\n+      <param name=\"base_link_frame_output\" value=\"$(arg x3_name)\" />\r\n+      <param name=\"world_frame\" value=\"$(arg x3_name)/odom\" />\r\n       <param name=\"publish_tf\" value=\"false\" />\r\n       <param name=\"imu0\" value=\"imu/data\" />\r\n       <rosparam param=\"imu0_config\">\r\n```\r\n\r\n\u200c\r\n\r\nAfter applying both of these fixes, both the X3 and X4 respond to commands on \u201c/<vehicle\\_name>/cmd\\_vel\u201d.  As a side note, if the TF tree changes again this will need to be reconfigured for both.", "markup": "markdown", "html": "<p>There is a broken link in the UKF from the new TF tree that prevents filtered odometry from being published and thus the conversion from RPY Thrust to individual motor commands from going through.  It can be fixed as follows for the X4:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r d09a3c51a635 x4_control/launch/control.launch</span>\n<span class=\"gd\">--- a/x4_control/launch/control.launch  Fri Jun 28 23:16:31 2019 +0000</span>\n<span class=\"gi\">+++ b/x4_control/launch/control.launch  Tue Jul 02 17:13:54 2019 -0400</span>\n<span class=\"gu\">@@ -11,9 +11,10 @@</span>\n       &lt;param name=&quot;frequency&quot; value=&quot;1000.&quot; /&gt;\n       &lt;param name=&quot;sensor_timeout&quot; value=&quot;0.2&quot; /&gt;\n       &lt;param name=&quot;two_d_mode&quot; value=&quot;false&quot; /&gt;\n<span class=\"gd\">-      &lt;param name=&quot;odom_frame&quot; value=&quot;$(arg world_name)&quot; /&gt;</span>\n<span class=\"gd\">-      &lt;param name=&quot;base_link_frame&quot; value=&quot;$(arg world_name)/$(arg x4_name)/base_link/imu_sensor&quot; /&gt;</span>\n<span class=\"gd\">-      &lt;param name=&quot;world_frame&quot; value=&quot;$(arg world_name)&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;odom_frame&quot; value=&quot;$(arg x4_name)/odom&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;base_link_frame&quot; value=&quot;$(arg x4_name)&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;base_link_frame_output&quot; value=&quot;$(arg x4_name)&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;world_frame&quot; value=&quot;$(arg x4_name)/odom&quot; /&gt;</span>\n       &lt;param name=&quot;publish_tf&quot; value=&quot;false&quot; /&gt;\n       &lt;param name=&quot;imu0&quot; value=&quot;imu/data&quot; /&gt;\n       &lt;rosparam param=&quot;imu0_config&quot;&gt;\n</pre></div>\n\n\n<p>This is also the case with the X3:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"gh\">diff -r d09a3c51a635 x3_control/launch/control.launch</span>\n<span class=\"gd\">--- a/x3_control/launch/control.launch  Fri Jun 28 23:16:31 2019 +0000</span>\n<span class=\"gi\">+++ b/x3_control/launch/control.launch  Tue Jul 02 17:26:36 2019 -0400</span>\n<span class=\"gu\">@@ -11,9 +11,10 @@</span>\n       &lt;param name=&quot;frequency&quot; value=&quot;1000.&quot; /&gt;\n       &lt;param name=&quot;sensor_timeout&quot; value=&quot;0.2&quot; /&gt;\n       &lt;param name=&quot;two_d_mode&quot; value=&quot;false&quot; /&gt;\n<span class=\"gd\">-      &lt;param name=&quot;odom_frame&quot; value=&quot;$(arg world_name)&quot; /&gt;</span>\n<span class=\"gd\">-      &lt;param name=&quot;base_link_frame&quot; value=&quot;$(arg world_name)/$(arg x3_name)/base_link/imu_sensor&quot; /&gt;</span>\n<span class=\"gd\">-      &lt;param name=&quot;world_frame&quot; value=&quot;$(arg world_name)&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;odom_frame&quot; value=&quot;$(arg x3_name)/odom&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;base_link_frame&quot; value=&quot;$(arg x3_name)&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;base_link_frame_output&quot; value=&quot;$(arg x3_name)&quot; /&gt;</span>\n<span class=\"gi\">+      &lt;param name=&quot;world_frame&quot; value=&quot;$(arg x3_name)/odom&quot; /&gt;</span>\n       &lt;param name=&quot;publish_tf&quot; value=&quot;false&quot; /&gt;\n       &lt;param name=&quot;imu0&quot; value=&quot;imu/data&quot; /&gt;\n       &lt;rosparam param=&quot;imu0_config&quot;&gt;\n</pre></div>\n\n\n<p>\u200c</p>\n<p>After applying both of these fixes, both the X3 and X4 respond to commands on \u201c/&lt;vehicle_name&gt;/cmd_vel\u201d.  As a side note, if the TF tree changes again this will need to be reconfigured for both.</p>", "type": "rendered"}, "assignee": {"display_name": "Ian Chen", "uuid": "{eaa6fca5-6deb-43f6-907f-971c144735dd}", "links": {"self": {"href": "https://api.bitbucket.org/2.0/users/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D"}, "html": {"href": "https://bitbucket.org/%7Beaa6fca5-6deb-43f6-907f-971c144735dd%7D/"}, "avatar": {"href": "https://avatar-management--avatars.us-west-2.prod.public.atl-paas.net/557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5/1e4adcdf-1946-4280-9aea-eb5f15a7f912/128"}}, "nickname": "Ian Chen", "type": "user", "account_id": "557058:10b01d41-a2e9-4a41-a907-e6e2f03b6cd5"}, "state": "closed", "version": null, "edited_on": null, "created_on": "2019-07-02T21:28:57.660238+00:00", "milestone": null, "updated_on": "2019-10-31T06:04:03.267390+00:00", "type": "issue", "id": 94}